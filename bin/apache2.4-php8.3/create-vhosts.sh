#!/bin/bash

# ------------------------------------------------------------------------------
# DASHBOARD

if [ "$SSL_TYPE" = "plain"]; then

    cat << EOF > /etc/apache2/sites-enabled/default.conf
<VirtualHost *:80>

    DocumentRoot ${APACHE_DOCUMENT_ROOT}

	<Directory ${APACHE_DOCUMENT_ROOT}>
		Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
	</Directory>

</VirtualHost>

EOF

fi

if [ "$SSL_TYPE" = "ssl"]; then

    cp /root/.local/share/mkcert/rootCA.pem /etc/apache2/ssl/rootCA.crt
    cp /root/.local/share/mkcert/rootCA-key.pem /etc/apache2/ssl/rootCA-key.key

    echo "*.${DOMAIN}"

    mkcert -cert-file "/etc/apache2/ssl/dockbox.crt" -key-file "/etc/apache2/ssl//dockbox.key" localhost "*.${DOMAIN}"

    cat << EOF > /etc/apache2/sites-enabled/default.conf
<VirtualHost *:443>

    DocumentRoot ${APACHE_DOCUMENT_ROOT}

	<Directory ${APACHE_DOCUMENT_ROOT}>
		Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
	</Directory>
    
    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/dockbox.crt
    SSLCertificateKeyFile /etc/apache2/ssl/dockbox.key

</VirtualHost>

EOF

fi

# # ------------------------------------------------------------------------------
# # HOSTS AUTOGENERATED

# # plain
# if [ "$SSL_TYPE" = "plain" ]; then

#     cat << EOF >> /etc/apache2/sites-enabled/default.conf
# <VirtualHost *:80>

#     UseCanonicalName Off
#     VirtualDocumentRoot ${APACHE_SHARED_ROOT}/%1
#     ServerAlias *.${DOMAIN}

#     <Directory ${APACHE_SHARED_ROOT}>
#         Options Indexes FollowSymLinks
#         AllowOverride All
#         Require all granted
#     </Directory>

# </VirtualHost>

# EOF

# elif [ "$SSL_TYPE" = "ssl" ]; then

#     cat << EOF >> /etc/apache2/sites-enabled/default.conf
# <VirtualHost *:443>

#     UseCanonicalName Off
#     VirtualDocumentRoot ${APACHE_SHARED_ROOT}/%1
#     ServerAlias *.${DOMAIN}

#     <Directory ${APACHE_SHARED_ROOT}>
#         Options Indexes FollowSymLinks
#         AllowOverride All
#         Require all granted
#     </Directory>

#     SSLEngine on
#     SSLCertificateFile /etc/apache2/ssl/dockbox.crt
#     SSLCertificateKeyFile /etc/apache2/ssl/dockbox.key

# </VirtualHost>

# EOF

# fi

# # ------------------------------------------------------------------------------
# # MESSAGE

# echo "Hosts created."